<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="css/bootstrap.css">
    <link type="text/css" rel="stylesheet" href="datepicker/css/persianDatepicker-default.css">

    <title>Courses Section</title>
</head>
<body>


<!--add course here-->
<button type="button" class="btn btn-primary" onclick="showCreateCourseForm()">اضافه کردن دوره</button>

<div id="modal-force-to-close">
    <div class="modal fade" id="createCourse" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">اطلاعات دوره را وارد کنید</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="title" class="col-form-label">نام دوره</label>
                            <input type="text" class="form-control" id="title">
                        </div>
                        <div class="form-group">
                            <label for="desc" class="col-form-label">توضیحات دوره</label>
                            <input type="text" class="form-control" id="desc">
                        </div>
                        <div class="form-group">
                            <label for="myDate" class="col-form-label">تاریخ شروع</label>
                            <input type="text" id="myDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="myDate2" class="col-form-label">تاریخ پایان</label>
                            <input type="text" id="myDate2" class="form-control">
                        </div>

                        <div class="form-group">
                            <select id="status">
                                <option value="OnGoing">در حال اجرا</option>
                                <option value="Suspend">تعلیق شده</option>
                                <option value="Ended">تمام شده</option>
                            </select>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="addCourseByManager()">ایجاد دوره</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!--end  add course here-->
<button type="button" class="btn btn-primary" onclick="getAllCoursesByManager()">نمایش دوره ها</button>

<!--show course here-->
<table class="table table-striped table-hover" style="padding-top: 10px">
    <thead class="thead-dark">
    <tr>
        <th scope="col">#</th>
        <th scope="col">تاریخ شروع</th>
        <th scope="col">تاریخ پایان</th>
        <th scope="col">وضعیت</th>
        <th scope="col">نام دوره</th>
        <th scope="col">توضیحات</th>
        <th scope="col">افزودن استاد</th>
        <th scope="col">افزودن دانشجو</th>
        <th scope="col">جزئیات</th>
        <th scope="col">ویرایش</th>
        <th scope="col">حذف</th>
    </tr>
    </thead>
    <tbody id="table-body">

    </tbody>
</table>

<!--end show courses-->

<!-- start delete courses-->

<div class="modal fade" id="deleteCourse" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabelInput">Delete Course</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="course-delete-id" class="col-form-label">course Id:</label>
                        <input type="text" class="form-control" id="course-delete-id" readonly>
                    </div>
                    <div class="form-group">
                        <label for="course-delete-title" class="col-form-label">course title:</label>
                        <input type="text" class="form-control" id="course-delete-title" readonly>
                    </div>
                    <div class="form-group">
                        <label for="course-delete-teacher" class="col-form-label">course status:</label>
                        <input type="text" class="form-control" id="course-delete-teacher" readonly>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger" onclick="deleteCourseByManager()">Delete course</button>
            </div>
        </div>
    </div>
</div>
</div>

<!--end delete courses-->

<!--start add teacher to course-->
<div class="modal fade" id="addTeacher" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addTeacherTitle">اضافه کردن استاد</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <table class="table table-striped table-hover" style="padding-top: 10px">
                    <thead class="thead-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">نام استاد</th>
                        <th scope="col">نام خانوادگی</th>
                        <th scope="col">انتخاب</th>
                    </tr>
                    </thead>
                    <tbody id="teacher-table-body">

                    </tbody>
                </table>

                <button type="button" onclick="getAllTeachersByManager()">جستجو</button>

                <form>
                    <div class="form-group">
                        <input type="hidden" id="course-id">
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
</div>

<!--end add teacher to course-->

<!--start add teacher to course-->
<div class="modal fade" id="addStudent" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addStudentTitle">اضافه کردن دانشجو</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <table class="table table-striped table-hover" style="padding-top: 10px">
                    <thead class="thead-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">نام دانشجو</th>
                        <th scope="col">نام خانوادگی</th>
                        <th scope="col">انتخاب</th>
                    </tr>
                    </thead>
                    <tbody id="student-table-body">

                    </tbody>
                </table>
                <input type="hidden" id="courseIdForStudent">
                <button type="button" onclick="getAllStudentsByManager()">جستجو</button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
</div>

<!--end add teacher to course-->

<!--start show all courses-->

<div class="modal fade" id="courseDetails" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">جزئیات دوره</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <table class="table table-striped table-hover" style="padding-top: 10px">
                    <thead class="thead-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">نام مدرس</th>
                        <th scope="col">نام خانوادگی</th>
                        <th scope="col">انتخاب</th>
                    </tr>
                    </thead>
                    <tbody id="teacher-course-table-body">

                    </tbody>
                </table>

                <table class="table table-striped table-hover" style="padding-top: 10px">
                    <thead class="thead-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">نام دانشجو</th>
                        <th scope="col">نام خانوادگی</th>
                        <th scope="col">انتخاب</th>
                    </tr>
                    </thead>
                    <tbody id="student-course-table-body">

                    </tbody>
                </table>


                <input type="hidden" id="courseIdForShowCourse" onload="getCourseByManager()">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
</div>

<!--end show All Courses-->

<!--start edit course-->

<div class="modal fade" id="courseEdit" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ویرایش دوره</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <form>
                    <div class="form-group">
                        <label for="title" class="col-form-label">نام دوره</label>
                        <input type="text" class="form-control" id="edit-title">
                    </div>
                    <div class="form-group">
                        <label for="desc" class="col-form-label">توضیحات دوره</label>
                        <input type="text" class="form-control" id="edit-desc">
                    </div>
                    <div class="form-group">
                        <label for="myDate" class="col-form-label">تاریخ شروع</label>
                        <input type="text" id="edit-myDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="myDate2" class="col-form-label">تاریخ پایان</label>
                        <input type="text" id="edit-myDate2" class="form-control">
                    </div>

                    <div class="form-group">
                        <select id="edit-status">
                            <option value="OnGoing">در حال اجرا</option>
                            <option value="Suspend">تعلیق شده</option>
                            <option value="Ended">تمام شده</option>
                        </select>
                    </div>

                </form>



                <input type="text" id="courseIdForEditCourse" readonly>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="editCourse()">ویرایش</button>

                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
</div>


<!--end edit course-->
<script type="text/javascript" src="js/jquery-3.4.1.js"></script>
<script type="text/javascript" src="js/popper.min.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<!--<script type="text/javascript" src="Manager-Course/Manager-Course.js"></script>-->

<script>
    function showCreateCourseForm() {
        $("#createCourse").modal('toggle');
    }
    function addCourseByManager() {
        const title = $("#title").val();
        const desc = $("#desc").val();
        const status = $("#status").val();
        const startDate = $("#myDate").val();
        const endDate = $("#myDate2").val();


        const Course = {

            "startDate": startDate,
            "endDate": endDate,
            "status" : status,
            "courseTitle": title,
            "courseDesc": desc
        };
        $.ajax({
            type: "POST",
            url: "http://localhost:8080/Courses/Create",
            data: JSON.stringify(Course),
            contentType: "application/json; charset=utf-8",
            success: function (data, textStatus) {

            },
            error: function (errorMessage) {
                alert("some things went wrong!");
            }
        });
        $("#createCourse").modal('hide');

    }
    function getAllCoursesByManager() {
        $.ajax({
            url: "http://localhost:8080/Courses/get-all-courses",
            type: "POST",
            success: function (data, textStatus, jQxhr) {
                //console.table(data.accountDtoList);
                prepareCourseTable(data);
            },
            error: function (errorMessage) {
                alert("errorMessage")
            }
        });
    }
    function prepareCourseTable(data) {
        globaldata = data;
        let content = '';
        for (let i = 0; i < data.length; i++) {
            content += "<tr>";
            content += "<th scope='row'>" + data[i].id + "</th>";
            content += "<td >" + data[i].startDate + "</td>";
            content += "<td >" + data[i].endDate + "</td>";
            content += "<td id=" + i + ">" + data[i].status + "</td>";
            content += "<td >" + data[i].courseTitle + "</td>";
            content += "<td >" + data[i].courseDesc + "</td>";

            content += "<td >" +
                "<button type='button' class='btn btn-outline-primary btn-sm' onclick='showAddTeacherModal(" + i + ")'>Add Teacher</button>" +
                "</td>";

            content += "<td >" +
                "<button type='button' class='btn btn-outline-primary btn-sm' onclick='showAddStudentModal(" + i + ")'>Add Student</button>" +
                "</td>";

            content += "<td >" +
                "<button type='button' class='btn btn-outline-danger btn-sm' onclick='showCourseDetailsModal(" + i + ")'>ShowDetails</button>" +
                "</td>";

            content += "<td >" +
                "<button type='button' class='btn btn-outline-danger btn-sm' onclick='showEditCourseModal(" + i + ")'>Edit</button>" +
                "</td>";

            content += "<td >" +
                "<button type='button' class='btn btn-outline-danger btn-sm' onclick='showDeleteCourseModal(" + i + ")'>Delete</button>" +
                "</td>";
            content += "</tr>";
        }
        $('#table-body').html(content);
    }
    function showDeleteCourseModal(data) {
        $("#course-delete-id").val(globaldata[data].id);
        $("#course-delete-title").val(globaldata[data].courseTitle);
        $("#course-delete-teacher").val(globaldata[data].status);
        $("#deleteCourse").modal('toggle');
    }
    function deleteCourseByManager() {

        const courseId = $("#course-delete-id").val();

        $.ajax({
            url:  "http://localhost:8080/Courses/delete-course",
            type: "POST",
            data: JSON.stringify(courseId),
            contentType: "application/json; charset=utf-8",
            success: function (data, textStatus) {
                if (data.message !== null) {
                    loadAllCourseForManager();
                } else {
                    alert("some things went wrong");
                }
            },
            error: function (errorMessage) {
                alert("some things went wrong!");
            }
        });
        $("#deleteCourse").modal('hide');

    }
    function showAddTeacherModal(data) {
        $("#course-id").val(globaldata[data].id);
        $("#addTeacher").modal('toggle');
    }
    function getAllTeachersByManager() {
        $.ajax({
            url: "http://localhost:8080/get-all-teachers",
            type: "POST",
            success: function (data, textStatus, jQxhr) {
                prepareTeacherTable(data);
            },
            error: function (errorMessage) {
                alert(errorMessage)
            }
        });
    }
    function prepareTeacherTable(data) {
        globalTeacher = data;
        let content = '';
        for (let i = 0; i < data.length; i++) {
            content += "<tr>";
            content += "<th scope='row'>" + data[i].id + "</th>";
            content += "<td >" + data[i].firstname + "</td>";
            content += "<td >" + data[i].lastname + "</td>";
            content += "<td >" +
                "<button type='button' class='btn btn-primary btn-sm' onclick='chooseTeacher("+ data[i].id +")'>choose</button>" +
                "</td>";

            content += "</tr>";
        }
        $('#teacher-table-body').html(content);
    }
    function chooseTeacher(data) {
        const courseId = $("#course-id").val();
        const ids = [courseId,data]
        $.ajax({
            type: "POST",
            url : "http://localhost:8080/add-teacher",
            data: JSON.stringify(ids),
            contentType: "application/json; charset=utf-8",
            success: function(data){
                alert(data)
            }


        });
    }
    function showAddStudentModal(data) {
        $("#courseIdForStudent").val(globaldata[data].id);
        $("#addStudent").modal('toggle');
    }
    function getAllStudentsByManager() {
        $.ajax({
            url: "http://localhost:8080/get-all-students",
            type: "POST",
            success: function (data, textStatus, jQxhr) {
                //console.table(data.accountDtoList);
                prepareStudentTable(data);
            },
            error: function (errorMessage) {
                alert(errorMessage)
            }
        });
    }
    function prepareStudentTable(data) {

        let content = '';
        for (let i = 0; i < data.length; i++) {
            content += "<tr>";
            content += "<th scope='row'>" + data[i].id + "</th>";
            content += "<td >" + data[i].firstname + "</td>";
            content += "<td >" + data[i].lastname + "</td>";
            content += "<td >" +
                "<button type='button' class='btn btn-primary btn-sm' onclick='chooseStudent("+ data[i].id +")'>choose</button>" +
                "</td>";

            content += "</tr>";
        }
        $('#student-table-body').html(content);
    }
    function chooseStudent(data) {
        const courseId = $("#courseIdForStudent").val();
        const ids = [courseId,data]
        $.ajax({
            type: "POST",
            url : "http://localhost:8080/add-student-to-course",
            data: JSON.stringify(ids),
            contentType: "application/json; charset=utf-8",
            success: function(data){

            }
        });
    }
    function showCourseDetailsModal(data) {
        $("#courseIdForShowCourse").val(globaldata[data].id);
        $("#courseDetails").modal('toggle');
    }

    function getCourseByManager() {
        const courseId = $("#courseIdForShowCourse").val();
        $.ajax({
            url: "http://localhost:8080/Courses/get-course",
            type: "POST",
            data:JSON.stringify(courseId),
            contentType: "application/json; charset=utf-8",
            success: function (data, textStatus, jQxhr) {

                prepareCourseDtailsTable(data);
            },
            error: function (errorMessage) {
                alert(errorMessage)
            }
        });
    }
    function prepareCourseDtailsTable(data) {

        let teacherContent = '';
            teacherContent += "<tr>";
            teacherContent += "<th scope='row'>" + data.teacher.id + "</th>";
            teacherContent += "<td >" + data.teacher.firstname + "</td>";
            teacherContent += "<td >" + data.teacher.lastname + "</td>";

            teacherContent += "<td >" +
                "<button type='button' class='btn btn-outline-danger btn-sm' onclick='showDeleteCourseModal(" + i + ")'>Delete</button>" +
                "</td>";
            teacherContent += "</tr>";
        $('#teacher-course-table-body').html(teacherContent);

        //////----------------------------------------------
        let studentContent = '';
        for (let i = 0; i < data.students.length; i++) {
            studentContent += "<tr>";
            studentContent += "<th scope='row'>" + data.students[i].id + "</th>";
            studentContent += "<td >" + data.students[i].firstname + "</td>";
            studentContent += "<td >" + data.students[i].lastname + "</td>";

            studentContent += "<td >" +
                "<button type='button' class='btn btn-outline-danger btn-sm' onclick='showDeleteCourseModal(" + i + ")'>Delete</button>" +
                "</td>";
            studentContent += "</tr>";
        }
        $('#student-course-table-body').html(studentContent);
    }

    function showEditCourseModal(data) {
        $("#courseIdForEditCourse").val(globaldata[data].id);
        $("#edit-title").val(globaldata[data].courseTitle);
        $("#edit-status").val(globaldata[data].status);
        $("#edit-desc").val(globaldata[data].courseDesc);
        $("#edit-myDate").val(globaldata[data].startDate);
        $("#edit-myDate2").val(globaldata[data].endDate);
        $("#courseEdit").modal('toggle');
    }

    function editCourse() {
        const id = $("#courseIdForEditCourse").val();
        const title = $("#edit-title").val();
        const desc = $("#edit-desc").val();
        const status = $("#edit-status").val();
        const startDate = $("#edit-myDate").val();
        const endDate = $("#edit-myDate2").val();


        const Course = {
            "id" : id,
            "startDate": startDate,
            "endDate": endDate,
            "status" : status,
            "courseTitle": title,
            "courseDesc": desc
        };
        $.ajax({
            type: "POST",
            url: "http://localhost:8080/Courses/Edit",
            data: JSON.stringify(Course),
            contentType: "application/json; charset=utf-8",
            success: function (data, textStatus) {

            },
            error: function (errorMessage) {
                alert("some things went wrong!");
            }
        });
        $("#courseEdit").modal('hide');
    }
</script>
<script>
    $(document).ready(function () {
        $("#courseDetails").on('show.bs.modal',function () {
            getCourseByManager();
        })
    });
</script>
<script type="text/javascript" src="datepicker/js/persianDatepicker.js"></script>
<script type="text/javascript">
    $(function() {
        $("#myDate, #span1").persianDatepicker();
        $("#myDate2, #span1").persianDatepicker();
        $("#edit-myDate, #span1").persianDatepicker();
        $("#edit-myDate2, #span1").persianDatepicker();

    });
</script>

</body>
</html>